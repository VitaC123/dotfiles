#!/usr/bin/env bash

if pgrep -q Emacs; then
    echo "Error: Emacs currently running, please close before updating"
    exit 1
fi

source "$DOTFILES/utils/log.sh"

{
    cd "$EMACSDIR" || return

    echo "> UPGRADE"
    yes | bin/doom upgrade

    echo "> COMPILE"
    yes | bin/doom compile

    echo "> DOCTOR"
    bin/doom doctor

} 2>&1 | log "$0"
